<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Singko Ticket Prices</title>
    <!-- Stylesheet -->
    <link rel="stylesheet" href="Style/style.css" />
</head>

<body>
    <div class="homepage">
        <header>
            <!-- ======= Navigation and Button ======= -->
            <nav class="navbar">
                <ul class="all-links">
                    <li class="active"><a href="index.html">Home</a></li>
                    <li><a href="#index.html#about">About</a></li>
                    <li><a href="booking.html">Book</a></li>
                    <li><a href="#index.html#contact">Contact</a></li>
                </ul>
            </nav>
        </header>
    </div>

    <!-- ======= Ticket Prices ======= -->
    <div id="tick-pr">
        <h1>Ticket Prices</h1>

        <div class="hd-pr">
            <h2>Location and Price</h2>
        </div>
        <div class="tickets">
            <div class="tick1">
                <span id="ticketType1">2-DAY Star Wanderer (VIP)</span> - <span id="ticketPrice1">PHP 13,000.00</span>
                <span class="down" onClick='decreaseCount(event, this)'>-</span>
                <input type="text" value="0">
                <span class="up" onClick='increaseCount(event, this)'>+</span>
            </div>
            <div class="tick2">
                <span id="ticketType2">2-DAY Regular Wanderer</span> - <span id="ticketPrice2">PHP 7,000.00</span>
                <span class="down" onClick='decreaseCount(event, this)'>-</span>
                <input type="text" value="0">
                <span class="up" onClick='increaseCount(event, this)'>+</span>
            </div>
            <div class="tick3">
                <span id="ticketType3">2-DAY Early Entry</span> - <span id="ticketPrice3">PHP 6,000.00</span>
                <span class="down" onClick='decreaseCount(event, this)'>-</span>
                <input type="text" value="0">
                <span class="up" onClick='increaseCount(event, this)'>+</span>
            </div>
            <div class="tick4">
                <span id="ticketType4">DAY 1 - Regular Wanderer</span> - <span id="ticketPrice4">PHP 5,400.00</span>
                <span class="down" onClick='decreaseCount(event, this)'>-</span>
                <input type="text" value="0">
                <span class="up" onClick='increaseCount(event, this)'>+</span>
            </div>
            <div class="tick5">
                <span id="ticketType5">DAY 2 - Regular Wanderer</span> - <span id="ticketPrice5">PHP 5,400.00</span>
                <span class="down" onClick='decreaseCount(event, this)'>-</span>
                <input type="text" value="0">
                <span class="up" onClick='increaseCount(event, this)'>+</span>
            </div>
        </div>
        <button class="proceed" type="button" onclick="showSummary();">Calculate Order Summary</button>
        <button class="statistics" type="button" onclick="displayStats()">View Ticket Statistics</button>
    </div>

    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Order Summary</h2>
            <div class="rectangle" id="summaryContentRectangle">
                <div id="summaryContent"></div>
            </div>
            <div class="rectangle" id="totalCostRectangle">
                <p id="totalCostModal"></p>
            </div>
            <br>
            <button class="proceed-to-payment" type="button" onclick="proceedToPayment()">Proceed to Payment
                Details</button>
        </div>
    </div>
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePaymentModal()">&times;</span>
            <h2>Select Payment Method</h2>
            <form id="paymentForm" class="payment-method">
                <div class="buttons-container">
                    <input type="radio" name="paymentMethod" value="bank" id="bank-radio" class="bank-radio" />
                    <label for="bank-radio" class="bank-label">
                        <img src="Images/bank-logo.png" alt="Bank" />
                    </label>

                    <input type="radio" name="paymentMethod" value="gcash" id="gcash-radio" class="gcash-radio" />
                    <label for="gcash-radio" class="gcash-label">
                        <img src="Images/gcash-logo.png" alt="GCash" />
                    </label>
                </div>
                <br /><br />
                <button class="confirm-payment" type="button" onclick="confirmPaymentMethod()">Confirm</button>
            </form>
        </div>
    </div>




    <!-- SCRIPT -->
    <script>
        var button = document.querySelector(".proceed");
        button.addEventListener("click", function () {
            if (checkIfTicketsSelected()) {
                showSummaryModal();
            } else {
                alert("Please add at least one ticket before calculating the order summary.");
            }
        });
        function checkIfTicketsSelected() {
            var ticketQuantities = document.querySelectorAll(".tickets input");
            for (var i = 0; i < ticketQuantities.length; i++) {
                var quantity = parseInt(ticketQuantities[i].value, 10);
                if (quantity > 0) {
                    return true;
                }
            }
            return false;
        }
        function showSummaryModal() {
            var ticketQuantities = document.querySelectorAll(".tickets input");
            var selectedTickets = [];

            for (var i = 0; i < ticketQuantities.length; i++) {
                var quantity = parseInt(ticketQuantities[i].value, 10);
                if (quantity > 0) {
                    var ticketType = document.getElementById("ticketType" + (i + 1)).textContent;
                    var ticketPrice = document.getElementById("ticketPrice" + (i + 1)).textContent;
                    selectedTickets.push({ type: ticketType, price: ticketPrice, quantity: quantity });
                }
            }

            localStorage.setItem("selectedTickets", JSON.stringify(selectedTickets));

            var totalTickets = 0;
            var totalCost = 0;

            var summaryContent = document.getElementById("summaryContent");
            summaryContent.innerHTML = ''; // Clear any existing content

            var ticketTypes = [
                "2-DAY Star Wanderer (VIP)",
                "2-DAY Regular Wanderer",
                "2-DAY Early Entry",
                "DAY 1 - Regular Wanderer",
                "DAY 2 - Regular Wanderer"
            ];

            var ticketPrices = [13000, 7000, 6000, 5400, 5400];

            for (var i = 0; i < ticketQuantities.length; i++) {
                var quantity = parseInt(ticketQuantities[i].value, 10);
                totalTickets += quantity;

                if (quantity > 0) {
                    var ticketTypeRectangle = document.createElement('div');
                    ticketTypeRectangle.classList.add('rectangle');
                    ticketTypeRectangle.style.display = "block";

                    var label = document.createElement('label');
                    label.textContent = `${ticketTypes[i]} Quantity: ${quantity}`;

                    var ticketPrice = quantity * ticketPrices[i]; // Calculate the ticket price

                    var priceLabel = document.createElement('label');
                    priceLabel.textContent = `Ticket Price: PHP ${ticketPrice.toFixed(2)}`;

                    ticketTypeRectangle.appendChild(label);
                    ticketTypeRectangle.appendChild(priceLabel); // Append the price label
                    summaryContent.appendChild(ticketTypeRectangle);
                }

                totalCost += quantity * ticketPrices[i];
            }

            var totalCostModal = document.getElementById("totalCostModal");
            totalCostModal.textContent = "Total Cost: PHP " + totalCost.toFixed(2);

            var modal = document.getElementById("myModal");
            modal.style.display = "block";
        }


        function closeModal() {
            var modal = document.getElementById("myModal");
            modal.style.display = "none";
        }

        function increaseCount(a, b) {
            var input = b.previousElementSibling;
            var value = parseInt(input.value, 10);
            value = isNaN(value) ? 0 : value;
            value++;
            input.value = value;
            updateTotalCost();
        }

        function decreaseCount(a, b) {
            var input = b.nextElementSibling;
            var value = parseInt(input.value, 10);
            if (value > 1) {
                value = isNaN(value) ? 0 : value;
                value--;
                input.value = value;
                updateTotalCost();
            }
        }

        function proceedToPayment() {
            var paymentModal = document.getElementById("paymentModal");
            paymentModal.style.display = "block"; // Display the payment modal

            var confirmPaymentButton = document.querySelector(".confirm-payment");
            confirmPaymentButton.addEventListener("click", function () {
                var paymentMethod = document.querySelector('input[name="paymentMethod"]:checked');
                if (!paymentMethod) {
                    alert("Please select a payment method.");
                } else {
                    var ticketQuantities = document.querySelectorAll(".tickets input");
                    var totalTickets = 0;
                    var totalCost = 0;

                    for (var i = 0; i < ticketQuantities.length; i++) {
                        var quantity = parseInt(ticketQuantities[i].value, 10);
                        totalTickets += quantity;

                        var ticketPrices = [13000, 7000, 6000, 5400, 5400];
                        totalCost += quantity * ticketPrices[i];
                    }

                    var paymentOption = paymentMethod.value;
                    var redirectUrl = "";

                    if (paymentOption === "bank") {
                        redirectUrl = "bcheckout.html";
                    } else if (paymentOption === "gcash") {
                        redirectUrl = "gcheckout.html";
                    }

                    if (totalCost === 0) {
                        alert("Please add at least one ticket before proceeding to payment.");
                    } else {
                        if (redirectUrl === "bcheckout.html") {
                            window.location.href = redirectUrl + "?totalCost=" + totalCost; // Redirect to bcheckout with the totalCost
                        } else if (redirectUrl === "gcheckout.html") {
                            window.location.href = redirectUrl + "?totalCost=" + totalCost; // Redirect to gcheckout with the amount
                        }
                    }

                    closePaymentModal(); // Move the function call inside the else block
                }
            });
        }

        function closePaymentModal() {
            var paymentModal = document.getElementById("paymentModal");
            paymentModal.style.display = "none";
        }

        function displayStats() {
            if ('showOpenFilePicker' in window) {
                window.showOpenFilePicker()
                    .then(function (fileHandles) {
                        const fileHandle = fileHandles[0];
                        return fileHandle.getFile();
                    })
                    .then(function (file) {
                        return file.text();
                    })
                    .then(function (data) {
                        // Parse the XML content
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(data, 'application/xml');

                        const userData = xmlDoc.querySelectorAll('user');

                        // Initialize counters for gender and ticket type preferences
                        let male2DayVipCount = 0;
                        let male2DayRegularCount = 0;
                        let male2DayEarlyEntry = 0;
                        let maleRegularDay1 = 0;
                        let maleRegularDay2 = 0;
                        let female2DayVipCount = 0;
                        let female2DayRegularCount = 0;
                        let female2DayEarlyEntry = 0;
                        let femaleRegularDay1 = 0;
                        let femaleRegularDay2 = 0;

                        for (let user of userData) {
                            // Extract data from the XML
                            const sex = user.querySelector("sex").textContent;
                            const ticketType = user.querySelector("type").textContent;

                            // Count occurrences of each combination
                            if (sex === "male") {
                                if (ticketType === "2-DAY Star Wanderer (VIP)") {
                                    male2DayVipCount++;
                                } else if (ticketType === "2-DAY Regular Wanderer") {
                                    male2DayRegularCount++;
                                } else if (ticketType === "2-DAY Early Entry") {
                                    male2DayEarlyEntry++;
                                } else if (ticketType === "DAY 1 - Regular Wanderer") {
                                    maleRegularDay1++;
                                } else if (ticketType === "DAY 2 - Regular Wanderer") {
                                    maleRegularDay2++;
                                } 
                            } else if (sex === "female") {
                                if (ticketType === "2-DAY Star Wanderer (VIP)") {
                                    female2DayVipCount++;
                                } else if (ticketType === "2-DAY Regular Wanderer") {
                                    female2DayRegularCount++;
                                } else if (ticketType === "2-DAY Early Entry") {
                                    female2DayEarlyEntry++;
                                } else if (ticketType === "DAY 1 - Regular Wanderer") {
                                    femaleRegularDay1++;
                                } else if (ticketType === "DAY 2 - Regular Wanderer") {
                                    femaleRegularDay2++;
                                } 
                            } 
                        }

                        // Calculate the total number of users
                        const totalUsers = userData.length;

                        // Display the gender and ticket type preferences
                        console.log("Gender and Ticket Type Preferences:");
                        console.log("Male Preferences:");
                        console.log(`- 2-DAY Star Wanderer (VIP): ${((male2DayVipCount / totalUsers) * 100).toFixed(2)}%`);
                        console.log(`- 2-DAY Regular Wanderer: ${((male2DayRegularCount / totalUsers) * 100).toFixed(2)}%`);
                        console.log(`- 2-DAY Early Entry: ${((male2DayEarlyEntry / totalUsers) * 100).toFixed(2)}%`);
                        console.log(`- DAY 1 - Regular Wanderer: ${((maleRegularDay1 / totalUsers) * 100).toFixed(2)}%`);
                        console.log(`- DAY 2 - Regular Wanderer: ${((maleRegularDay2 / totalUsers) * 100).toFixed(2)}%`);
                
                        console.log("Female Preferences:");
                        console.log(`- 2-DAY Star Wanderer (VIP): ${((female2DayVipCount / totalUsers) * 100).toFixed(2)}%`);
                        console.log(`- 2-DAY Regular Wanderer: ${((female2DayRegularCount / totalUsers) * 100).toFixed(2)}%`);
                        console.log(`- 2-DAY Early Entry: ${((female2DayEarlyEntry / totalUsers) * 100).toFixed(2)}%`);
                        console.log(`- DAY 1 - Regular Wanderer: ${((femaleRegularDay1 / totalUsers) * 100).toFixed(2)}%`);
                        console.log(`- DAY 2 - Regular Wanderer: ${((femaleRegularDay2 / totalUsers) * 100).toFixed(2)}%`);

                    })
                    .catch(error => console.error("Error loading XML:", error));
            } else {
                console.error('showOpenFilePicker is not supported in this browser.');
            }
        }



    </script>

</body>

</html>